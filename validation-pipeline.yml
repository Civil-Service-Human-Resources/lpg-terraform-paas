trigger:
- idt-feature-*

variables:
  - name: servicePrincipal_client_id
    value: $(SERVICEPRINCIPAL_CLIENT_ID)
  - name: servicePrincipal_client_secret
    value: $(SERVICEPRINCIPAL_CLIENT_SECRET)
  - name: servicePrincipal_tenant_id
    value: $(SERVICEPRINCIPAL_TENANT_ID)
  - name: subscription_id
    value: $(SUBSCRIPTION_ID)


pool:
  vmImage: ubuntu-latest
  
steps:
  - task: TerraformInstaller@0
    displayName: Install Terraform
    inputs:
      terraformVersion: 0.13.0
  
  - task: AzureCLI@2
    displayName: "Log in to Azure CLI"
    inputs:
      azureSubscription: $(subscription_id)
      scriptType: bash
      addSpnToEnvironment: true
      scriptLocation: inlineScript
      inlineScript: |
        export ARM_CLIENT_ID=$servicePrincipal_client_id
        export ARM_CLIENT_SECRET=$servicePrincipal_client_secret
        export ARM_TENANT_ID=$servicePrincipal_tenant_id
  